{% extends 'base.html' %} {% load static %} 
{% block title %}Expense Details - DreamBiz Accounting{% endblock %} {% block content %}
<div x-data="expenseDetail()" class="max-w-4xl mx-auto p-6">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center justify-between">
      <div class="flex items-center">
        <a
          href="{% url 'expenses:expense_list' %}"
          class="text-gray-500 hover:text-gray-700 mr-4"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </a>
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Expense Details</h1>
          <p class="text-gray-600 mt-1">View and manage expense information</p>
        </div>
      </div>
      <div class="flex space-x-3">
        {% if can_edit %}
        <a
          href="{% url 'expenses:expense_edit' expense.id %}"
          class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center"
        >
          <svg
            class="w-5 h-5 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
            />
          </svg>
          Edit
        </a>
        {% endif %}
        <div class="relative" x-data="{ open: false }">
          <button
            @click="open = !open"
            class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center"
          >
            <svg
              class="w-5 h-5 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"
              />
            </svg>
            Actions
          </button>
          <div
            x-show="open"
            @click.away="open = false"
            class="absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg z-10 border border-gray-200"
          >
            <div class="py-1">
              <a
                @click.prevent="duplicateExpense()"
                href="#"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center"
              >
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
                Duplicate Expense
              </a>
              <a
                @click.prevent="addToReport()"
                href="#"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center"
              >
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                Add to Expense Report
              </a>
              <a
                @click.prevent="exportExpense()"
                href="#"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center"
              >
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                </svg>
                Export as PDF
              </a>
              <a
                @click.prevent="shareExpense()"
                href="#"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center"
              >
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                </svg>
                Share with Team
              </a>
              <hr class="my-1" />
              <a
                @click.prevent="deleteExpense()"
                href="#"
                class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100 flex items-center"
              >
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
                Delete
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Status Banner -->
  <div class="mb-6 p-4 rounded-lg" :class="getStatusBanner()">
    <div class="flex items-center justify-between">
      <div class="flex items-center">
        <svg
          class="w-6 h-6 mr-3"
          :class="getStatusIcon()"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
        <div>
          <p
            class="font-medium"
            :class="getStatusTextColor()"
            x-text="'Status: ' + expense.status.charAt(0).toUpperCase() + expense.status.slice(1)"
          ></p>
          <p class="text-sm opacity-75" x-text="getStatusMessage()"></p>
        </div>
      </div>
      <div x-show="expense.status === 'pending'" class="flex space-x-2">
        <button
          @click="approveExpense()"
          class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 text-sm"
        >
          Approve
        </button>
        <button
          @click="rejectExpense()"
          class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 text-sm"
        >
          Reject
        </button>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Basic Information -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">Basic Information</h3>
        </div>
        <div class="p-6">
          <dl class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <dt class="text-sm font-medium text-gray-500">Description</dt>
              <dd
                class="mt-1 text-sm text-gray-900"
                x-text="expense.description"
              ></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Amount</dt>
              <dd
                class="mt-1 text-lg font-semibold text-gray-900"
                x-text="'GH' + expense.amount"
              ></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Date</dt>
              <dd
                class="mt-1 text-sm text-gray-900"
                x-text="formatDate(expense.date)"
              ></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Category</dt>
              <dd class="mt-1">
                <span
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                  x-text="expense.category"
                ></span>
              </dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Vendor</dt>
              <dd
                class="mt-1 text-sm text-gray-900"
                x-text="expense.vendor || 'Not specified'"
              ></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Payment Method</dt>
              <dd
                class="mt-1 text-sm text-gray-900"
                x-text="expense.paymentMethod"
              ></dd>
            </div>
          </dl>
        </div>
      </div>

      <!-- Tax Information -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">Tax Information</h3>
        </div>
        <div class="p-6">
          <dl class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <dt class="text-sm font-medium text-gray-500">Tax Amount</dt>
              <dd
                class="mt-1 text-sm text-gray-900"
                x-text="'GH' + (expense.taxAmount || '0.00')"
              ></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">
                Billable to Client
              </dt>
              <dd class="mt-1">
                <span
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                  :class="expense.isBillable ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'"
                  x-text="expense.isBillable ? 'Yes' : 'No'"
                >
                </span>
              </dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Total Amount</dt>
              <dd
                class="mt-1 text-lg font-semibold text-gray-900"
                x-text="'GH' + getTotalAmount()"
              ></dd>
            </div>
          </dl>
        </div>
      </div>

      <!-- Additional Details -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">Additional Details</h3>
        </div>
        <div class="p-6">
          <dl class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <dt class="text-sm font-medium text-gray-500">
                Reference Number
              </dt>
              <dd
                class="mt-1 text-sm text-gray-900"
                x-text="expense.referenceNumber || 'Not provided'"
              ></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Location</dt>
              <dd
                class="mt-1 text-sm text-gray-900"
                x-text="expense.location || 'Not specified'"
              ></dd>
            </div>
            <div class="md:col-span-2">
              <dt class="text-sm font-medium text-gray-500">Notes</dt>
              <dd
                class="mt-1 text-sm text-gray-900"
                x-text="expense.notes || 'No additional notes'"
              ></dd>
            </div>
          </dl>
        </div>
      </div>

      <!-- Approval History -->
      <div
        x-show="expense.approvalHistory && expense.approvalHistory.length > 0"
        class="bg-white rounded-lg shadow-sm border border-gray-200"
      >
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">Approval History</h3>
        </div>
        <div class="p-6">
          <div class="flow-root">
            <ul class="-mb-8">
              <template
                x-for="(item, index) in expense.approvalHistory"
                :key="index"
              >
                <li>
                  <div
                    class="relative pb-8"
                    :class="{ 'pb-0': index === expense.approvalHistory.length - 1 }"
                  >
                    <div
                      x-show="index !== expense.approvalHistory.length - 1"
                      class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200"
                    ></div>
                    <div class="relative flex space-x-3">
                      <div
                        class="flex h-8 w-8 items-center justify-center rounded-full"
                        :class="getApprovalStatusColor(item.action)"
                      >
                        <svg
                          class="h-5 w-5 text-white"
                          fill="currentColor"
                          viewBox="0 0 20 20"
                        >
                          <path
                            x-show="item.action === 'approved'"
                            fill-rule="evenodd"
                            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                            clip-rule="evenodd"
                          />
                          <path
                            x-show="item.action === 'rejected'"
                            fill-rule="evenodd"
                            d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                      <div class="min-w-0 flex-1">
                        <div>
                          <div class="text-sm">
                            <span
                              class="font-medium text-gray-900"
                              x-text="item.user"
                            ></span>
                            <span
                              x-text="item.action"
                              class="text-gray-500"
                            ></span>
                            <span class="text-gray-500">this expense</span>
                          </div>
                          <p
                            class="mt-0.5 text-sm text-gray-500"
                            x-text="item.date"
                          ></p>
                        </div>
                        <div
                          x-show="item.comment"
                          class="mt-2 text-sm text-gray-700"
                        >
                          <p x-text="item.comment"></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
              </template>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- Receipt -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">Receipt</h3>
        </div>
        <div class="p-6">
          <template x-if="expense.receipt">
            <div>
              <img
                :src="expense.receipt"
                class="w-full rounded-lg shadow-md mb-4"
                alt="Receipt"
              />
              <div class="flex space-x-2">
                <button
                  @click="viewReceiptFullscreen()"
                  class="flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 text-sm"
                >
                  View Full Size
                </button>
                <button
                  @click="downloadReceipt()"
                  class="flex-1 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 text-sm"
                >
                  Download
                </button>
              </div>
            </div>
          </template>
          <template x-if="!expense.receipt">
            <div class="text-center py-8">
              <svg
                class="mx-auto h-12 w-12 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                />
              </svg>
              <p class="text-gray-500 text-sm mt-2">No receipt uploaded</p>
              <button
                @click="uploadReceipt()"
                class="mt-3 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm"
              >
                Upload Receipt
              </button>
            </div>
          </template>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">Quick Actions</h3>
        </div>
        <div class="p-6">
          <div class="space-y-3">
            <button
              @click.prevent="duplicateExpense()"
              class="w-full flex items-center justify-start px-4 py-3 bg-gradient-to-r from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 text-blue-700 rounded-lg transition-all duration-200 border border-blue-200"
            >
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              <div class="text-left">
                <div class="font-medium text-sm">Duplicate Expense</div>
                <div class="text-xs text-blue-600">Create a copy of this expense</div>
              </div>
            </button>

            <button
              @click.prevent="addToReport()"
              class="w-full flex items-center justify-start px-4 py-3 bg-gradient-to-r from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 text-green-700 rounded-lg transition-all duration-200 border border-green-200"
            >
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <div class="text-left">
                <div class="font-medium text-sm">Add to Expense Report</div>
                <div class="text-xs text-green-600">Include in a report</div>
              </div>
            </button>

            <button
              @click.prevent="exportExpense()"
              class="w-full flex items-center justify-start px-4 py-3 bg-gradient-to-r from-purple-50 to-purple-100 hover:from-purple-100 hover:to-purple-200 text-purple-700 rounded-lg transition-all duration-200 border border-purple-200"
            >
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
              </svg>
              <div class="text-left">
                <div class="font-medium text-sm">Export as PDF</div>
                <div class="text-xs text-purple-600">Download PDF document</div>
              </div>
            </button>

            <button
              @click.prevent="shareExpense()"
              class="w-full flex items-center justify-start px-4 py-3 bg-gradient-to-r from-orange-50 to-orange-100 hover:from-orange-100 hover:to-orange-200 text-orange-700 rounded-lg transition-all duration-200 border border-orange-200"
            >
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
              </svg>
              <div class="text-left">
                <div class="font-medium text-sm">Share with Team</div>
                <div class="text-xs text-orange-600">Send to team members</div>
              </div>
            </button>
          </div>
        </div>
      </div>

      <!-- AI Insights -->
      <div
        class="bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-lg"
      >
        <div class="px-6 py-4 border-b border-purple-200">
          <h3 class="text-lg font-medium text-purple-800">AI Insights</h3>
        </div>
        <div class="p-6">
          <div class="space-y-4">
            <div class="flex items-start">
              <svg
                class="w-5 h-5 text-purple-600 mt-0.5 mr-3"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
              <div>
                <p class="text-sm font-medium text-purple-800">
                  Categorization Confidence
                </p>
                <p class="text-sm text-purple-700">
                  95% - Correctly categorized as Office Supplies
                </p>
              </div>
            </div>
            <div class="flex items-start">
              <svg
                class="w-5 h-5 text-purple-600 mt-0.5 mr-3"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
                />
              </svg>
              <div>
                <p class="text-sm font-medium text-purple-800">
                  Spending Pattern
                </p>
                <p class="text-sm text-purple-700">
                  Within normal range for this category
                </p>
              </div>
            </div>
            <div class="flex items-start">
              <svg
                class="w-5 h-5 text-yellow-600 mt-0.5 mr-3"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.865-.833-2.635 0L4.178 16.5c-.77.833.192 2.5 1.732 2.5z"
                />
              </svg>
              <div>
                <p class="text-sm font-medium text-yellow-800">
                  Tax Optimization
                </p>
                <p class="text-sm text-yellow-700">
                  Consider bundling similar purchases for better deductions
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function expenseDetail() {
    return {
      expense: {
        id: {{ expense.id }},
        description: "{{ expense.description|escapejs }}",
        amount: "{{ expense.amount }}",
        date: "{{ expense.date|date:'Y-m-d' }}",
        category: "{{ expense.category.name|escapejs }}",
        vendor: "{{ expense.vendor.name|default:''|escapejs }}",
        paymentMethod: "{{ expense.get_payment_method_display|escapejs }}",
        taxAmount: "{{ expense.tax_amount|default:'0.00' }}",
        isBillable: {{ expense.is_billable|yesno:"true,false" }},
        referenceNumber: "{{ expense.reference_number|default:''|escapejs }}",
        location: "{{ expense.location|default:''|escapejs }}",
        notes: "{{ expense.notes|default:''|escapejs }}",
        status: "{{ expense.status }}",
        receipt: {% if expense.receipt %}"{{ expense.receipt.url }}"{% else %}null{% endif %},
        approvalHistory: [],
      },

      formatDate(dateString) {
        return new Date(dateString).toLocaleDateString("en-US", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      },

      getTotalAmount() {
        const amount = parseFloat(this.expense.amount) || 0;
        const tax = parseFloat(this.expense.taxAmount) || 0;
        return (amount + tax).toFixed(2);
      },

      getStatusBanner() {
        const statusClasses = {
          draft: "bg-gray-100 border-gray-300",
          pending: "bg-yellow-50 border-yellow-300",
          approved: "bg-green-50 border-green-300",
          paid: "bg-blue-50 border-blue-300",
          rejected: "bg-red-50 border-red-300",
        };
        return (
          statusClasses[this.expense.status] || "bg-gray-100 border-gray-300"
        );
      },

      getStatusTextColor() {
        const textColors = {
          draft: "text-gray-800",
          pending: "text-yellow-800",
          approved: "text-green-800",
          paid: "text-blue-800",
          rejected: "text-red-800",
        };
        return textColors[this.expense.status] || "text-gray-800";
      },

      getStatusIcon() {
        return this.getStatusTextColor();
      },

      getStatusMessage() {
        const messages = {
          draft: "This expense is saved as a draft and not yet submitted.",
          pending: "This expense is awaiting approval from a manager.",
          approved: "This expense has been approved and is ready for payment.",
          paid: "This expense has been paid and processed.",
          rejected: "This expense was rejected and requires revision.",
        };
        return messages[this.expense.status] || "";
      },

      getApprovalStatusColor(action) {
        const colors = {
          submitted: "bg-blue-500",
          approved: "bg-green-500",
          rejected: "bg-red-500",
          pending: "bg-yellow-500",
        };
        return colors[action] || "bg-gray-500";
      },

      editExpense() {
        window.location.href = "{% url 'expenses:expense_edit' expense.id %}";
      },

      async approveExpense() {
        if (confirm("Are you sure you want to approve this expense?")) {
          try {
            const response = await fetch("{% url 'expenses:expense_approve' expense.id %}", {
              method: 'POST',
              headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'X-Requested-With': 'XMLHttpRequest',
              },
            });
            
            const data = await response.json();
            
            if (data.success) {
              this.expense.status = data.status;
              alert(data.message);
              // Reload page to reflect changes
              window.location.reload();
            } else {
              alert('Error: ' + data.error);
            }
          } catch (error) {
            console.error('Error approving expense:', error);
            alert('Failed to approve expense. Please try again.');
          }
        }
      },

      async rejectExpense() {
        const reason = prompt("Please provide a reason for rejection:");
        if (reason) {
          try {
            const formData = new FormData();
            formData.append('reason', reason);
            
            const response = await fetch("{% url 'expenses:expense_reject' expense.id %}", {
              method: 'POST',
              headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'X-Requested-With': 'XMLHttpRequest',
              },
              body: formData,
            });
            
            const data = await response.json();
            
            if (data.success) {
              this.expense.status = data.status;
              alert(data.message);
              // Reload page to reflect changes
              window.location.reload();
            } else {
              alert('Error: ' + data.error);
            }
          } catch (error) {
            console.error('Error rejecting expense:', error);
            alert('Failed to reject expense. Please try again.');
          }
        }
      },

      deleteExpense() {
        if (confirm("Are you sure you want to delete this expense? This action cannot be undone.")) {
          window.location.href = "{% url 'expenses:expense_delete' expense.id %}";
        }
      },

      viewReceiptFullscreen() {
        if (this.expense.receipt) {
          window.open(this.expense.receipt, '_blank');
        }
      },

      downloadReceipt() {
        if (this.expense.receipt) {
          const link = document.createElement('a');
          link.href = this.expense.receipt;
          link.download = `expense-${this.expense.id}-receipt`;
          link.click();
        } else {
          alert("No receipt available to download");
        }
      },

      uploadReceipt() {
        // TODO: Implement receipt upload via modal
        alert("Receipt upload feature coming soon!");
      },

      duplicateExpense() {
        if (confirm("Create a duplicate of this expense?\n\nThe duplicate will be created as a draft with today's date, and you'll be redirected to edit it.")) {
          window.location.href = "{% url 'expenses:expense_duplicate' expense.id %}";
        }
      },

      addToReport() {
        // Redirect to add to report page
        window.location.href = "{% url 'expenses:expense_add_to_report' expense.id %}";
      },

      exportExpense() {
        // Open PDF export in new window
        window.open("{% url 'expenses:expense_export_pdf' expense.id %}", '_blank');
      },

      shareExpense() {
        // TODO: Implement team sharing feature
        const email = prompt("Enter email address to share with:");
        if (email) {
          alert(`Share with Team feature\n\nThis expense will be shared with: ${email}\n\nFeatures:\n• Share via email or internal messaging\n• Set permission levels (view/edit)\n• Track who viewed the expense\n• Add collaborators for approval\n\nComing soon!`);
        }
      },
    };
  }
</script>
{% endblock %}
