{% extends 'base.html' %}
{% load static %}

{% block title %}{{ company.name }} - Company Settings{% endblock %}

{% block content %}
<div x-data="companyDetail()">
  <!-- Page Header -->
  <div class="mb-8">
    <div class="flex items-center justify-between">
      <div class="flex items-center">
        <a href="{% url 'accounts:company_list' %}" class="mr-4 text-gray-600 hover:text-gray-900">
          <i class="fas fa-arrow-left"></i>
        </a>
        <div>
          <h1 class="text-3xl font-bold text-gray-900">{{ company.name }}</h1>
          <p class="mt-1 text-sm text-gray-600">Manage company settings and information</p>
        </div>
      </div>

      {% if user_company.role in 'owner,admin' %}
      <button @click="editMode = !editMode"
              class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
        <i class="fas" :class="editMode ? 'fa-times' : 'fa-edit'" class="mr-2"></i>
        <span x-text="editMode ? 'Cancel' : 'Edit Company'"></span>
      </button>
      {% endif %}
    </div>
  </div>

  <!-- Tabs -->
  <div class="border-b border-gray-200 mb-6">
    <nav class="flex space-x-8">
      <button @click="activeTab = 'general'"
              :class="activeTab === 'general' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
              class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
        <i class="fas fa-info-circle mr-2"></i>
        General Info
      </button>
      <button @click="activeTab = 'branding'"
              :class="activeTab === 'branding' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
              class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
        <i class="fas fa-palette mr-2"></i>
        Branding
      </button>
      <button @click="activeTab = 'financial'"
              :class="activeTab === 'financial' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
              class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
        <i class="fas fa-dollar-sign mr-2"></i>
        Financial Settings
      </button>
      <button @click="activeTab = 'team'"
              :class="activeTab === 'team' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
              class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
        <i class="fas fa-users mr-2"></i>
        Team Members
      </button>
    </nav>
  </div>

  <form method="post" enctype="multipart/form-data" @submit.prevent="saveCompany">
    {% csrf_token %}

    <!-- General Info Tab -->
    <div x-show="activeTab === 'general'" x-transition>
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-6">Company Information</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Company Name -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Company Name</label>
            <input type="text" name="name" value="{{ company.name }}"
                   :readonly="!editMode"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   :class="!editMode && 'bg-gray-50'">
          </div>

          <!-- Registration Number -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Registration Number</label>
            <input type="text" name="registration_number" value="{{ company.registration_number }}"
                   :readonly="!editMode"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   :class="!editMode && 'bg-gray-50'">
          </div>

          <!-- Tax ID -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Tax ID</label>
            <input type="text" name="tax_id" value="{{ company.tax_id }}"
                   :readonly="!editMode"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   :class="!editMode && 'bg-gray-50'">
          </div>

          <!-- Email -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
            <input type="email" name="email" value="{{ company.email }}"
                   :readonly="!editMode"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   :class="!editMode && 'bg-gray-50'">
          </div>

          <!-- Phone -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
            <input type="tel" name="phone" value="{{ company.phone }}"
                   :readonly="!editMode"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   :class="!editMode && 'bg-gray-50'">
          </div>

          <!-- Website -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Website</label>
            <input type="url" name="website" value="{{ company.website }}"
                   :readonly="!editMode"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   :class="!editMode && 'bg-gray-50'">
          </div>
        </div>

        <!-- Address Section -->
        <h4 class="text-md font-semibold text-gray-900 mt-8 mb-4">Address</h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-2">Address Line 1</label>
            <input type="text" name="address_line_1" value="{{ company.address_line_1 }}"
                   :readonly="!editMode"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   :class="!editMode && 'bg-gray-50'">
          </div>

          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-2">Address Line 2</label>
            <input type="text" name="address_line_2" value="{{ company.address_line_2 }}"
                   :readonly="!editMode"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   :class="!editMode && 'bg-gray-50'">
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
            <input type="text" name="city" value="{{ company.city }}"
                   :readonly="!editMode"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   :class="!editMode && 'bg-gray-50'">
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">State/Province</label>
            <input type="text" name="state" value="{{ company.state }}"
                   :readonly="!editMode"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   :class="!editMode && 'bg-gray-50'">
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Postal Code</label>
            <input type="text" name="postal_code" value="{{ company.postal_code }}"
                   :readonly="!editMode"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   :class="!editMode && 'bg-gray-50'">
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
            <input type="text" name="country" value="{{ company.country }}"
                   :readonly="!editMode"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   :class="!editMode && 'bg-gray-50'">
          </div>
        </div>
      </div>
    </div>

    <!-- Branding Tab -->
    <div x-show="activeTab === 'branding'" x-transition>
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-6">Company Branding</h3>

        <div class="space-y-6">
          <!-- Logo Upload -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Company Logo</label>
            <div class="flex items-center space-x-6">
              {% if company.logo %}
              <div class="w-24 h-24 rounded-lg border-2 border-gray-200 overflow-hidden">
                <img src="{{ company.logo.url }}" alt="{{ company.name }}" class="w-full h-full object-cover">
              </div>
              {% else %}
              <div class="w-24 h-24 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center bg-gray-50">
                <i class="fas fa-building text-3xl text-gray-400"></i>
              </div>
              {% endif %}

              <div x-show="editMode">
                <input type="file" name="logo" accept="image/*" class="block text-sm text-gray-600">
                <p class="text-xs text-gray-500 mt-1">PNG, JPG up to 2MB</p>
              </div>
            </div>
          </div>

          <!-- Primary Color -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Primary Brand Color</label>
            <div class="flex items-center space-x-4">
              <input type="color" name="primary_color" value="{{ company.primary_color }}"
                     :disabled="!editMode"
                     class="h-10 w-20 rounded border border-gray-300">
              <span class="text-sm text-gray-600">{{ company.primary_color }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Financial Settings Tab -->
    <div x-show="activeTab === 'financial'" x-transition>
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-6">Financial Settings</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Currency -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Currency</label>
            <select name="currency" :disabled="!editMode"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    :class="!editMode && 'bg-gray-50'">
              <option value="GHS" {% if company.currency == 'GHS' %}selected{% endif %}>Ghanaian Cedi (GHS)</option>
              <option value="USD" {% if company.currency == 'USD' %}selected{% endif %}>US Dollar (USD)</option>
              <option value="EUR" {% if company.currency == 'EUR' %}selected{% endif %}>Euro (EUR)</option>
              <option value="GBP" {% if company.currency == 'GBP' %}selected{% endif %}>British Pound (GBP)</option>
            </select>
          </div>

          <!-- Fiscal Year Start -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Fiscal Year Start</label>
            <input type="date" name="fiscal_year_start" value="{{ company.fiscal_year_start|date:'Y-m-d' }}"
                   :readonly="!editMode"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   :class="!editMode && 'bg-gray-50'">
          </div>

          <!-- Timezone -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
            <select name="timezone" :disabled="!editMode"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    :class="!editMode && 'bg-gray-50'">
              <option value="UTC" {% if company.timezone == 'UTC' %}selected{% endif %}>UTC</option>
              <option value="Africa/Accra" {% if company.timezone == 'Africa/Accra' %}selected{% endif %}>Africa/Accra (GMT)</option>
              <option value="America/New_York" {% if company.timezone == 'America/New_York' %}selected{% endif %}>America/New_York (EST)</option>
              <option value="Europe/London" {% if company.timezone == 'Europe/London' %}selected{% endif %}>Europe/London (GMT)</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Team Members Tab -->
    <div x-show="activeTab === 'team'" x-transition>
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-semibold text-gray-900">Team Members</h3>
          <a href="{% url 'accounts:team_dashboard' %}"
             class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors">
            <i class="fas fa-user-plus mr-2"></i>
            Invite Member
          </a>
        </div>

        <div class="space-y-3">
          {% for member in team_members %}
          <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
            <div class="flex items-center">
              <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold">
                {{ member.user.first_name|first|default:member.user.username|first|upper }}
              </div>
              <div class="ml-3">
                <p class="text-sm font-medium text-gray-900">{{ member.user.get_full_name|default:member.user.username }}</p>
                <p class="text-xs text-gray-500">{{ member.user.email }}</p>
              </div>
            </div>
            <span class="px-3 py-1 rounded-full text-xs font-medium
                  {% if member.role == 'owner' %}bg-purple-100 text-purple-700
                  {% elif member.role == 'admin' %}bg-blue-100 text-blue-700
                  {% else %}bg-gray-100 text-gray-700{% endif %}">
              {{ member.get_role_display }}
            </span>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Save Button -->
    <div x-show="editMode" class="mt-6 flex justify-end space-x-4">
      <button type="button" @click="editMode = false"
              class="px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors">
        Cancel
      </button>
      <button type="submit"
              class="px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium rounded-lg transition-all shadow-md">
        <i class="fas fa-save mr-2"></i>
        Save Changes
      </button>
    </div>
  </form>
</div>

<script>
function companyDetail() {
  return {
    activeTab: 'general',
    editMode: false,

    saveCompany(event) {
      event.target.submit();
    }
  }
}
</script>
{% endblock %}
