{% extends 'base.html' %}
{% load static %}

{% block title %}Start Reconciliation - {{ account.name }} - DreamBiz{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
  <!-- Page Header -->
  <div class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-6">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Start Reconciliation</h1>
          <p class="mt-1 text-sm text-gray-600">
            {{ account.bank_name }} - {{ account.name }}
          </p>
        </div>
        <div class="flex space-x-3">
          <a
            href="{% url 'bank_reconciliation:account_detail' account.pk %}"
            class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200"
          >
            <i class="fas fa-arrow-left mr-2"></i>
            Back to Account
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Account Summary -->
    <div class="bg-gradient-to-r from-indigo-500 to-indigo-600 rounded-lg shadow-lg p-6 text-white mb-8">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div>
          <p class="text-indigo-100 text-sm font-medium">Account Name</p>
          <p class="text-2xl font-bold mt-1">{{ account.name }}</p>
        </div>
        <div>
          <p class="text-indigo-100 text-sm font-medium">Current Balance</p>
          <p class="text-2xl font-bold mt-1">GH{{ account.current_balance|floatformat:2 }}</p>
        </div>
        <div>
          <p class="text-indigo-100 text-sm font-medium">Account Number</p>
          <p class="text-2xl font-bold mt-1">{{ account.masked_account_number }}</p>
        </div>
      </div>
    </div>

    <!-- Instructions -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
      <div class="flex">
        <div class="flex-shrink-0">
          <i class="fas fa-info-circle text-blue-600 text-2xl"></i>
        </div>
        <div class="ml-4">
          <h3 class="text-lg font-medium text-blue-900 mb-2">How to Reconcile</h3>
          <ol class="text-sm text-blue-700 space-y-2 list-decimal list-inside">
            <li>Select a bank statement below to reconcile</li>
            <li>Match transactions from your books with bank transactions</li>
            <li>Mark transactions as cleared when they appear on the statement</li>
            <li>Resolve any discrepancies between your books and the bank</li>
            <li>Complete the reconciliation when balances match</li>
          </ol>
        </div>
      </div>
    </div>

    <!-- Select Statement -->
    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">
          <i class="fas fa-file-invoice mr-2 text-indigo-600"></i>
          Select Statement to Reconcile
        </h3>
      </div>
      <div class="p-6">
        {% if statements %}
        <form method="post">
          {% csrf_token %}
          <div class="space-y-4">
            {% for statement in statements %}
            <label class="relative block cursor-pointer">
              <input type="radio" 
                     name="statement_id" 
                     value="{{ statement.id }}" 
                     class="sr-only peer" 
                     required>
              <div class="border-2 border-gray-300 rounded-lg p-4 hover:border-indigo-500 peer-checked:border-indigo-600 peer-checked:bg-indigo-50 transition-all duration-200">
                <div class="flex items-center justify-between">
                  <div class="flex-1">
                    <div class="flex items-center space-x-4">
                      <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
                          <i class="fas fa-file-invoice text-indigo-600 text-xl"></i>
                        </div>
                      </div>
                      <div>
                        <h4 class="text-base font-semibold text-gray-900">
                          Statement Date: {{ statement.statement_date|date:"M d, Y" }}
                        </h4>
                        <p class="text-sm text-gray-600">
                          Period: {{ statement.statement_period_start|date:"M d" }} - {{ statement.statement_period_end|date:"M d, Y" }}
                        </p>
                        <p class="text-sm text-gray-600 mt-1">
                          <span class="font-medium">Transactions:</span> {{ statement.transaction_count }}
                          <span class="mx-2">â€¢</span>
                          <span class="font-medium">Unreconciled:</span> 
                          <span class="{% if statement.unreconciled_count > 0 %}text-orange-600{% else %}text-green-600{% endif %} font-semibold">
                            {{ statement.unreconciled_count }}
                          </span>
                        </p>
                      </div>
                    </div>
                  </div>
                  <div class="text-right">
                    <p class="text-sm text-gray-500">Ending Balance</p>
                    <p class="text-2xl font-bold text-gray-900">GH{{ statement.ending_balance|floatformat:2 }}</p>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium mt-1
                                 {% if statement.status == 'reconciled' %}bg-green-100 text-green-800
                                 {% elif statement.status == 'partially_reconciled' %}bg-yellow-100 text-yellow-800
                                 {% else %}bg-gray-100 text-gray-800{% endif %}">
                      {{ statement.get_status_display }}
                    </span>
                  </div>
                </div>
              </div>
            </label>
            {% endfor %}
          </div>

          <div class="mt-8 flex justify-between items-center pt-6 border-t border-gray-200">
            <a href="{% url 'bank_reconciliation:account_detail' account.pk %}" 
               class="inline-flex items-center px-6 py-3 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200">
              <i class="fas fa-times mr-2"></i>
              Cancel
            </a>
            <button type="submit" 
                    class="inline-flex items-center px-6 py-3 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200">
              <i class="fas fa-check-double mr-2"></i>
              Start Reconciliation
            </button>
          </div>
        </form>
        {% else %}
        <!-- No Statements Available -->
        <div class="text-center py-12">
          <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4">
            <i class="fas fa-file-invoice text-gray-400 text-4xl"></i>
          </div>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No Statements Available</h3>
          <p class="text-gray-600 mb-6">
            You need to import a bank statement before you can start reconciliation.
          </p>
          <a
            href="{% url 'bank_reconciliation:statement_create' %}"
            class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
          >
            <i class="fas fa-upload mr-2"></i>
            Import Bank Statement
          </a>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Help Card -->
    <div class="bg-white rounded-lg shadow-lg overflow-hidden mt-8">
      <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
        <h3 class="text-lg font-semibold text-gray-900">
          <i class="fas fa-question-circle mr-2 text-indigo-600"></i>
          Need Help?
        </h3>
      </div>
      <div class="p-6">
        <div class="space-y-4 text-sm text-gray-700">
          <div>
            <h4 class="font-semibold text-gray-900 mb-1">What is Bank Reconciliation?</h4>
            <p>Bank reconciliation is the process of matching your internal financial records with your bank statement to ensure accuracy and identify any discrepancies.</p>
          </div>
          <div>
            <h4 class="font-semibold text-gray-900 mb-1">Why is it Important?</h4>
            <p>Regular reconciliation helps you detect errors, prevent fraud, ensure accurate financial reporting, and maintain control over your cash flow.</p>
          </div>
          <div>
            <h4 class="font-semibold text-gray-900 mb-1">Best Practices</h4>
            <ul class="list-disc list-inside space-y-1 mt-2">
              <li>Reconcile at least monthly</li>
              <li>Keep detailed records of all transactions</li>
              <li>Investigate discrepancies immediately</li>
              <li>Save reconciliation reports for audit purposes</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
