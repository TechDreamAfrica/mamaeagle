{% extends 'base.html' %}
{% load static %}

{% block title %}Comparative Financial Analysis{% endblock %}

{% block extra_css %}
<style>
    .statement-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 10px;
        margin-bottom: 2rem;
    }
    
    .statement-section {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #2d3748;
        border-bottom: 3px solid #667eea;
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .comparison-table {
        width: 100%;
        margin-top: 1rem;
    }
    
    .comparison-table th {
        background: #f7fafc;
        padding: 0.75rem;
        text-align: right;
        font-weight: 600;
        border-bottom: 2px solid #e2e8f0;
    }
    
    .comparison-table th:first-child {
        text-align: left;
    }
    
    .comparison-table td {
        padding: 0.75rem;
        text-align: right;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .comparison-table td:first-child {
        text-align: left;
        font-weight: 500;
    }
    
    .trend-positive {
        color: #48bb78;
    }
    
    .trend-negative {
        color: #f56565;
    }
    
    .trend-arrow {
        display: inline-block;
        margin-left: 0.5rem;
    }
    
    .chart-container {
        height: 300px;
        margin-top: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Header -->
    <div class="statement-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="mb-2">Comparative Financial Analysis</h1>
                <h3>{{ start_year }} - {{ end_year }}</h3>
                <p class="mb-0">Multi-year comparison prepared in accordance with {{ accounting_standard }}</p>
            </div>
        </div>
    </div>
    
    <!-- Period Selector -->
    <div class="statement-section no-print">
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <label class="form-label">Start Year</label>
                <input type="number" name="start_year" value="{{ start_year }}" class="form-control" min="2000" max="2100">
            </div>
            <div class="col-md-3">
                <label class="form-label">End Year</label>
                <input type="number" name="end_year" value="{{ end_year }}" class="form-control" min="2000" max="2100">
            </div>
            <div class="col-md-3">
                <label class="form-label">Accounting Standard</label>
                <select name="standard" class="form-select">
                    <option value="GAAP" {% if accounting_standard == "GAAP" %}selected{% endif %}>GAAP</option>
                    <option value="IFRS" {% if accounting_standard == "IFRS" %}selected{% endif %}>IFRS</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">&nbsp;</label>
                <button type="submit" class="btn btn-primary w-100">Generate Analysis</button>
            </div>
        </form>
    </div>
    
    <!-- Revenue Comparison -->
    <div class="statement-section">
        <h2 class="section-title">Revenue Comparison</h2>
        <table class="comparison-table table">
            <thead>
                <tr>
                    <th>Year</th>
                    <th>Revenue</th>
                    <th>Gross Profit</th>
                    <th>Operating Income</th>
                    <th>Net Income</th>
                </tr>
            </thead>
            <tbody>
                {% for data in yearly_data %}
                <tr>
                    <td>{{ data.year }}</td>
                    <td>GH{{ data.revenue|floatformat:2 }}</td>
                    <td>GH{{ data.gross_profit|floatformat:2 }}</td>
                    <td>GH{{ data.operating_income|floatformat:2 }}</td>
                    <td>GH{{ data.net_income|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Growth Trends -->
    <div class="statement-section">
        <h2 class="section-title">Growth Trends (Year-over-Year)</h2>
        
        <h4 class="mt-3">Revenue Growth</h4>
        <table class="comparison-table table">
            <thead>
                <tr>
                    <th>Year</th>
                    <th>Growth Rate</th>
                </tr>
            </thead>
            <tbody>
                {% for trend in trends.revenue_growth %}
                <tr>
                    <td>{{ trend.year }}</td>
                    <td class="{% if trend.growth >= 0 %}trend-positive{% else %}trend-negative{% endif %}">
                        {{ trend.growth|floatformat:1 }}%
                        <span class="trend-arrow">
                            {% if trend.growth >= 0 %}↑{% else %}↓{% endif %}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <h4 class="mt-4">Profit Growth</h4>
        <table class="comparison-table table">
            <thead>
                <tr>
                    <th>Year</th>
                    <th>Growth Rate</th>
                </tr>
            </thead>
            <tbody>
                {% for trend in trends.profit_growth %}
                <tr>
                    <td>{{ trend.year }}</td>
                    <td class="{% if trend.growth >= 0 %}trend-positive{% else %}trend-negative{% endif %}">
                        {{ trend.growth|floatformat:1 }}%
                        <span class="trend-arrow">
                            {% if trend.growth >= 0 %}↑{% else %}↓{% endif %}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Balance Sheet Comparison -->
    <div class="statement-section">
        <h2 class="section-title">Balance Sheet Comparison</h2>
        <table class="comparison-table table">
            <thead>
                <tr>
                    <th>Year</th>
                    <th>Total Assets</th>
                    <th>Total Liabilities</th>
                    <th>Total Equity</th>
                </tr>
            </thead>
            <tbody>
                {% for data in yearly_data %}
                <tr>
                    <td>{{ data.year }}</td>
                    <td>GH{{ data.total_assets|floatformat:2 }}</td>
                    <td>GH{{ data.total_liabilities|floatformat:2 }}</td>
                    <td>GH{{ data.total_equity|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Cash Flow Comparison -->
    <div class="statement-section">
        <h2 class="section-title">Operating Cash Flow Comparison</h2>
        <table class="comparison-table table">
            <thead>
                <tr>
                    <th>Year</th>
                    <th>Operating Cash Flow</th>
                </tr>
            </thead>
            <tbody>
                {% for data in yearly_data %}
                <tr>
                    <td>{{ data.year }}</td>
                    <td>GH{{ data.operating_cash_flow|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Footer -->
    <div class="text-center text-muted mt-4 mb-4">
        <p>Comparative analysis generated for strategic planning and decision-making purposes.</p>
        <p>Generated on {{ "now"|date:"F d, Y at h:i A" }}</p>
    </div>
</div>
{% endblock %}
